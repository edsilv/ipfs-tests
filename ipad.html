<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>IPFS iPad Test</title>
  <script src="https://unpkg.com/ipfs-api/dist/index.min.js"></script>
  <script src="https://unpkg.com/ipfs/dist/index.min.js"></script>
</head>
<body>

    <p id="useragent"></p>

    <p id="link"></p>

    <script>

        var userAgentElem = document.getElementById('useragent');
        userAgentElem.appendChild(document.createTextNode(navigator.userAgent ));

        var Buffer = window.IpfsApi().Buffer;

        var repoPath = 'ipfs-' + Math.random();

        // Create an IPFS node
        var node = new Ipfs({
            init: false,
            start: false,
            repo: repoPath
        });

        // Init the node
        node.init(handleInit);

        function handleInit(err) {

            if (err) {
                throw err;
            }

            node.start(function() {

                console.log('Online status: ', node.isOnline() ? 'online' : 'offline');
                
                var data = {
                    hello: "ipfs"
                }

                node.files.add(Buffer.from(JSON.stringify(data)), function (err, res) {
            
                    console.log("added");
                
                    if (err || !res) {
                        return console.error('Error - ipfs files add', err, res)
                    }

                    res.forEach(function(file) {
                        var linkElem = document.getElementById("link");
                        var aTag = document.createElement('a');
                        aTag.setAttribute('href', "http://ipfs.io/ipfs/" + file.hash);
                        aTag.setAttribute('target',"_blank");
                        aTag.setAttribute('id',"link");
                        aTag.innerHTML = file.hash;
                        linkElem.appendChild(aTag);
                    });

                });
            });
        }
    </script>
</body>
</html>